<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2017 SIGEM.
     Auteur : Sadjidine Salifou OMBOTIMBE
     License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl). -->

<odoo>
    <record model="report.paperformat" id="paperformat_report_suivi_sinistres">
        <field name="name">European A4 Landscape</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_width">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">35</field>
        <field name="margin_right">5</field>
        <field name="margin_bottom">10</field>
        <field name="margin_left">5</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">30</field>
        <field name="dpi">90</field>
    </record>
    <report id="report_reglements_sinistres_template"
            string="Rapport-Règlements Sinistres"
            model="proximas.reglement.sinistres.report.wizard"
            name="proximas_medical.report_reglements_sinistres_view"
            report_type="qweb-pdf"
            paperformat="paperformat_report_suivi_sinistres"
            menu="False"

    />
    <template id="report_reglements_sinistres_view">
        <t t-call="report.html_container">
            <t t-call="report.external_layout">
                <div class="page">
                    <!--Rapport Regroupement par Rubrique médicale-->
                    <t t-if="report_kpi in ['rubrique'] and report_type in ['groupe']">
                        <div class="header">
                            <h6 class="bg-primary invisible">...</h6>
                            <t t-if="filter_type in ['pec']">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE FACTURES PRESTATAIRES / RUBRIQUE MEDICALE
                                    </strong>
                                </h4>
                            </t>
                            <t t-if="filter_type in ['rfm']">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE REMBOURSEMENTS ADHERENTS / RUBRIQUE MEDICALE
                                    </strong>
                                </h4>
                            </t>
                            <div class="row">
                                <div class="col-xs-6">
                                    <p>
                                       <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                       <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                    </p>
                                </div>
                                <div class="col-xs-6">
                                    <t t-if="police_filter">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <div class="article">
                            <table class="table table-condensed table-bordered table-striped table-xs h6"
                                   style="width: 100% border-bottom: 2px solid black">
                                <thead class="bg-primary" >
                                    <th class="text-right"><strong>N°</strong></th>
                                    <th class="text-left"><strong>Rubrique Médicale</strong></th>
                                    <th class="text-right"><strong>Coût Moyen</strong></th>
                                    <th class="text-right"><strong>Nbre. Actes</strong></th>
                                    <th class="text-right"><strong>Totaux</strong></th>
                                    <th class="text-right"><strong>Totaux PC</strong></th>
                                    <th class="text-right"><strong>Totaux NPC</strong></th>
                                    <th class="text-right"><strong>Exclusions</strong></th>
                                    <th class="text-right"><strong>Ticket mod.</strong></th>
                                    <th class="text-right"><strong>Part SAM</strong></th>
                                    <th class="text-right"><strong>Net A Payer</strong></th>
                                </thead>
                                <tbody>
                                    <t t-set="num" t-value="0"/>
                                    <t t-set="tot_cout_moyen" t-value="0"/>
                                    <t t-set="tot_nbre_actes" t-value="0"/>
                                    <t t-set="tot_cout_total" t-value="0"/>
                                    <t t-set="tot_total_pc" t-value="0"/>
                                    <t t-set="tot_total_npc" t-value="0"/>
                                    <t t-set="tot_total_exclusion" t-value="0"/>
                                    <t t-set="tot_ticket_moderateur" t-value="0"/>
                                    <t t-set="tot_net_tiers_payeur" t-value="0"/>
                                    <t t-set="tot_net_a_payer" t-value="0"/>
                                    <t t-foreach="docs" t-as="doc">
                                        <t t-set="num" t-value="num + 1"/>
                                        <t t-set="cout_moyen" t-value="0"/>
                                        <t t-if="int(doc['nbre_actes']) != 0">
                                            <t t-set="cout_moyen" t-value="int(doc['cout_total'])/int(doc['nbre_actes'])"/>
                                        </t>
                                        <t t-set="tot_cout_moyen" t-value="tot_cout_moyen + cout_moyen"/>
                                        <t t-set="tot_nbre_actes" t-value="tot_nbre_actes + int(doc['nbre_actes'])"/>
                                        <t t-set="tot_cout_total" t-value="tot_cout_total + int(doc['cout_total'])"/>
                                        <t t-set="tot_total_pc" t-value="tot_total_pc + int(doc['total_pc'])"/>
                                        <t t-set="tot_total_npc" t-value="tot_total_npc + int(doc['total_npc'])"/>
                                        <t t-set="tot_total_exclusion" t-value="tot_total_exclusion + int(doc['total_exclusion'])"/>
                                        <t t-set="tot_ticket_moderateur" t-value="tot_ticket_moderateur + int(doc['ticket_moderateur'])"/>
                                        <t t-set="tot_net_tiers_payeur" t-value="tot_net_tiers_payeur + int(doc['net_tiers_payeur'])"/>
                                        <t t-set="tot_net_a_payer" t-value="tot_net_a_payer + int(doc['net_a_payer'])"/>
                                        <tr>
                                            <td class="text-center"><strong><span t-esc="num"/></strong></td>
                                            <td class="bg-info"><strong><span t-esc="doc['rubrique_medicale']"/></strong></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(cout_moyen)).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['nbre_actes']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(doc['cout_total'])).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_pc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_npc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_exclusion']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['ticket_moderateur']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['net_tiers_payeur']).replace(',',' ')"/></td>
                                            <td class="text-right bg-info"><strong><span t-esc="'{0:,.0f}'.format(doc['net_a_payer']).replace(',',' ')"/></strong></td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr class="text-right bg-info" style="border-top: 2px solid black;">
                                        <td colspan="3"><strong> RECAPITULATIF DES TOTAUX GENERAUX</strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_nbre_actes).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_cout_total).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_pc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_npc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_exclusion).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_ticket_moderateur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_tiers_payeur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_a_payer).replace(',',' ')"/></strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </t>
                    <!--RAPPORT DETAILLE PAR RUBRIQUE MEDICALE -->
                    <t t-if="report_kpi in ['rubrique'] and report_type in ['detail']">
                        <div class="header">
                            <h6 class="bg-primary invisible">...</h6>
                            <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - FACTURE PRESTATAIRE DE SOINS / RUBRIQUE MEDICALE
                                    </strong>
                                </h4>
                            </t>
                            <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - REMBOURSEMENT DE FRAIS MEDICAUX - ADHERENT / RUBRIQUE MEDICALE
                                    </strong>
                                </h4>
                            </t>
                            <div class="row">
                                <div class="col-xs-6">
                                    <p>
                                       <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                       <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                    </p>
                                </div>
                                <div class="col-xs-6">
                                    <t t-if="police_filter">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </t>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                        <table class="table table-condensed" style="border:1px solid black;">
                                           <caption>1. Détails Facture Prestataire:</caption>
                                            <tr>
                                                <td>
                                                    <h4>FACTURE N°      : <strong><t t-esc="num_facture"/> </strong></h4>
                                                    <p>V/Réf.           : <t t-esc="ref_facture"/></p>
                                                    <p>Date Emission    : <t t-esc="date_emission"/> </p>
                                                    <p>Date Réception   : <t t-esc="date_reception"/></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                    <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                        <table class="table table-condensed" style="border:1px solid black;">
                                           <caption>1.Détails Remboursement Frais Médicaux:</caption>
                                            <tr>
                                                <td>
                                                    <h4>RFM N°      : <strong><t t-esc="num_rfm"/> </strong></h4>
                                                    <p>Réf. Fiche   : <t t-esc="ref_fiche"/></p>
                                                    <p>Date Saisie  : <t t-esc="date_saisie"/> </p>
                                                    <p>Date depôt   : <t t-esc="date_depot"/></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                </div>
                                <div class="col-xs-5">
                                    <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                        <table class="table table-condensed bg-info" style="border:1px solid black;">
                                           <caption>2. DOIT - Prestataire:</caption>
                                            <tr>
                                                <td>
                                                    <p class="h5"><b><t t-esc="prestataire"/></b></p>
                                                    <p>Ville: <t t-esc="city"/></p>
                                                    <p>Tél.: <t t-esc="phone"/></p>
                                                    <p>Mobile: <b><t t-esc="mobile"/></b></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                    <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                        <table class="table table-condensed bg-info" style="border:1px solid black;">
                                           <caption>2. Détails Adhérent Souscripteur:</caption>
                                            <tr>
                                                <td>
                                                    <p class="h5"><b><t t-esc="adherent"/></b></p>
                                                    <p>Matricule: <t t-esc="matricule"/></p>
                                                    <p>Code ID.: <t t-esc="code_id"/></p>
                                                    <p>Groupe: <b><t t-esc="groupe"/></b></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                </div>
                                <div class="col-xs-1">
                                    <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                        <table class="table table-condensed">
                                           <!--<caption>Notes / Observations:</caption>-->
                                            <tr>
                                                <td class="text-center">
                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Standard93', o.num_facture, 340,  60)" style="width:340;height:60;"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                    <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                        <table class="table table-condensed">
                                           <!--<caption>Notes / Observations:</caption>-->
                                            <tr>
                                                <td class="text-center">
                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Standard93', o.num_rfm, 340,  60)" style="width:340;height:60;"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <div class="article">
                            <table class="table table-condensed table-bordered table-striped h6" style="width: 100% border-bottom: 2px solid black">
                                <caption>IMPORTANT: Le tableau ci-dessous présente la synthèse des actes médicaux qui ont été fournis par le prestataire de soins.
                                    Ces actes ont été regroupés par rubrique médicale en fonction de la nature et/ou le type de prestation médicale concenrnée.
                                    Sauf erreurs ou omissions, les données ont été générées automatiquement sur une période précise, c-à-d une plage de dates de début
                                    et de fin comme indiquée plus haut.
                                </caption>
                                <thead class="bg-primary" >
                                    <th class="text-right"><strong>N°</strong></th>
                                    <th class="text-left"><strong>Rubrique Médicale</strong></th>
                                    <th class="text-right"><strong>Coût Moyen</strong></th>
                                    <th class="text-right"><strong>Nbre. Actes</strong></th>
                                    <th class="text-right"><strong>Totaux</strong></th>
                                    <th class="text-right"><strong>Totaux PC</strong></th>
                                    <th class="text-right"><strong>Totaux NPC</strong></th>
                                    <th class="text-right"><strong>Exclusions</strong></th>
                                    <th class="text-right"><strong>Ticket mod.</strong></th>
                                    <th class="text-right"><strong>Part SAM</strong></th>
                                    <th class="text-right"><strong>Net A Payer</strong></th>
                                </thead>
                                <tbody>
                                    <t t-set="num" t-value="0"/>
                                    <t t-set="tot_cout_moyen" t-value="0"/>
                                    <t t-set="tot_nbre_actes" t-value="0"/>
                                    <t t-set="tot_cout_total" t-value="0"/>
                                    <t t-set="tot_total_pc" t-value="0"/>
                                    <t t-set="tot_total_npc" t-value="0"/>
                                    <t t-set="tot_total_exclusion" t-value="0"/>
                                    <t t-set="tot_ticket_moderateur" t-value="0"/>
                                    <t t-set="tot_net_tiers_payeur" t-value="0"/>
                                    <t t-set="tot_net_a_payer" t-value="0"/>
                                    <t t-foreach="docs" t-as="doc">
                                        <t t-set="num" t-value="num + 1"/>
                                        <t t-set="cout_moyen" t-value="0"/>
                                        <t t-if="int(doc['nbre_actes']) != 0">
                                            <t t-set="cout_moyen" t-value="int(doc['cout_total'])/int(doc['nbre_actes'])"/>
                                        </t>
                                        <t t-set="tot_cout_moyen" t-value="tot_cout_moyen + cout_moyen"/>
                                        <t t-set="tot_nbre_actes" t-value="tot_nbre_actes + int(doc['nbre_actes'])"/>
                                        <t t-set="tot_cout_total" t-value="tot_cout_total + int(doc['cout_total'])"/>
                                        <t t-set="tot_total_pc" t-value="tot_total_pc + int(doc['total_pc'])"/>
                                        <t t-set="tot_total_npc" t-value="tot_total_npc + int(doc['total_npc'])"/>
                                        <t t-set="tot_total_exclusion" t-value="tot_total_exclusion + int(doc['total_exclusion'])"/>
                                        <t t-set="tot_ticket_moderateur" t-value="tot_ticket_moderateur + int(doc['ticket_moderateur'])"/>
                                        <t t-set="tot_net_tiers_payeur" t-value="tot_net_tiers_payeur + int(doc['net_tiers_payeur'])"/>
                                        <t t-set="tot_net_a_payer" t-value="tot_net_a_payer + int(doc['net_a_payer'])"/>
                                        <tr>
                                            <td class="text-center"><strong><span t-esc="num"/></strong></td>
                                            <td class="bg-info"><strong><span t-esc="doc['rubrique_medicale']"/></strong></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(cout_moyen)).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['nbre_actes']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(doc['cout_total'])).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_pc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_npc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_exclusion']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['ticket_moderateur']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['net_tiers_payeur']).replace(',',' ')"/></td>
                                            <td class="text-right bg-info"><strong><span t-esc="'{0:,.0f}'.format(doc['net_a_payer']).replace(',',' ')"/></strong></td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr class="text-right bg-info" style="border-top: 2px solid black;">
                                        <td colspan="3"><strong> RECAPITULATIF DES TOTAUX GENERAUX</strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_nbre_actes).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_cout_total).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_pc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_npc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_exclusion).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_ticket_moderateur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_tiers_payeur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_a_payer).replace(',',' ')"/></strong></td>
                                    </tr>
                                    <tr class="text-right">
                                        <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                            <td colspan="11">
                                                <span>Arrêtée la présente facture, à la somme de :</span> <strong><t t-esc="montant_facture"/> </strong>
                                            </td>
                                        </t>
                                        <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                            <td colspan="11">
                                                <span>Arrêté le présent remboursement, à la somme de :</span> <strong><t t-esc="montant_rfm"/> </strong>
                                            </td>
                                        </t>
                                    </tr>
                                </tfoot>
                            </table>
                            <div class="row"> -
                                <div class="col-xs-12">
                                    <p><b>CADRE RESERVE COMITE DE GESTION:</b></p>
                                    <table class="table table-condensed table-bordered table-striped h6" style="border:1px solid black;">
                                        <tr>
                                            <td class="col-xs-4">
                                                <p>Règlement effectué par :_____________________________</p>
                                                <p>Montant payé (en lettre):_____________________________</p>
                                                <p>Date Règlement :_________/__________/_______________</p>
                                                <p>Réf.chèque :________________________________________</p>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa &amp; Cachet - Comptabilité</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa Correspondance</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <t t-if="filter_type in ['pec']">
                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s'
                                                % ('Code128', num_facture, 320,  60)" style="width:320;height:60;"
                                                />
                                                </t>
                                                <t t-if="filter_type in ['rfm']">
                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s'
                                                % ('Code128', num_rfm, 320,  60)" style="width:320;height:60;"
                                                    />
                                                </t>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </t>
                    <!--Rapport Regroupement par Prestation médicale-->
                    <t t-if="report_kpi in ['prestation'] and report_type in ['groupe']">
                        <div class="header">
                            <h6 class="bg-primary invisible">...</h6>
                            <t t-if="filter_type in ['pec']">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE FACTURES PRESTATAIRES / PRESTATIONS MEDICALES
                                    </strong>
                                </h4>
                            </t>
                            <t t-if="filter_type in ['rfm']">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE REMBOURSEMENTS ADHERENTS / PRESTATIONS MEDICALES
                                    </strong>
                                </h4>
                            </t>
                            <div class="row">
                                <div class="col-xs-6">
                                    <p>
                                       <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                       <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                    </p>
                                </div>
                                <div class="col-xs-6">
                                    <t t-if="police_filter">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <div class="article">
                            <table class="table table-condensed table-bordered table-striped table-xs h6"
                                   style="width: 100% border-bottom: 2px solid black">
                                <thead class="bg-primary" >
                                    <th class="text-right"><strong>N°</strong></th>
                                    <th class="text-left"><strong>Prestation Médicale</strong></th>
                                    <th class="text-right"><strong>Coût Moyen</strong></th>
                                    <th class="text-right"><strong>Nbre. Actes</strong></th>
                                    <th class="text-right"><strong>Totaux</strong></th>
                                    <th class="text-right"><strong>Totaux PC</strong></th>
                                    <th class="text-right"><strong>Totaux NPC</strong></th>
                                    <th class="text-right"><strong>Exclusions</strong></th>
                                    <th class="text-right"><strong>Ticket mod.</strong></th>
                                    <th class="text-right"><strong>Part SAM</strong></th>
                                    <th class="text-right"><strong>Net A Payer</strong></th>
                                </thead>
                                <tbody>
                                    <t t-set="num" t-value="0"/>
                                    <t t-set="tot_cout_moyen" t-value="0"/>
                                    <t t-set="tot_nbre_actes" t-value="0"/>
                                    <t t-set="tot_cout_total" t-value="0"/>
                                    <t t-set="tot_total_pc" t-value="0"/>
                                    <t t-set="tot_total_npc" t-value="0"/>
                                    <t t-set="tot_total_exclusion" t-value="0"/>
                                    <t t-set="tot_ticket_moderateur" t-value="0"/>
                                    <t t-set="tot_net_tiers_payeur" t-value="0"/>
                                    <t t-set="tot_net_a_payer" t-value="0"/>
                                    <t t-foreach="docs" t-as="doc">
                                        <t t-set="num" t-value="num + 1"/>
                                        <t t-set="cout_moyen" t-value="0"/>
                                        <t t-if="int(doc['nbre_actes']) != 0">
                                            <t t-set="cout_moyen" t-value="int(doc['cout_total'])/int(doc['nbre_actes'])"/>
                                        </t>
                                        <t t-set="tot_cout_moyen" t-value="tot_cout_moyen + cout_moyen"/>
                                        <t t-set="tot_nbre_actes" t-value="tot_nbre_actes + int(doc['nbre_actes'])"/>
                                        <t t-set="tot_cout_total" t-value="tot_cout_total + int(doc['cout_total'])"/>
                                        <t t-set="tot_total_pc" t-value="tot_total_pc + int(doc['total_pc'])"/>
                                        <t t-set="tot_total_npc" t-value="tot_total_npc + int(doc['total_npc'])"/>
                                        <t t-set="tot_total_exclusion" t-value="tot_total_exclusion + int(doc['total_exclusion'])"/>
                                        <t t-set="tot_ticket_moderateur" t-value="tot_ticket_moderateur + int(doc['ticket_moderateur'])"/>
                                        <t t-set="tot_net_tiers_payeur" t-value="tot_net_tiers_payeur + int(doc['net_tiers_payeur'])"/>
                                        <t t-set="tot_net_a_payer" t-value="tot_net_a_payer + int(doc['net_a_payer'])"/>
                                        <tr>
                                            <td class="text-center"><strong><span t-esc="num"/></strong></td>
                                            <td class="bg-info"><span t-esc="doc['prestation_medicale']"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(cout_moyen)).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['nbre_actes']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(doc['cout_total'])).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_pc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_npc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_exclusion']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['ticket_moderateur']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['net_tiers_payeur']).replace(',',' ')"/></td>
                                            <td class="text-right bg-info"><strong><span t-esc="'{0:,.0f}'.format(doc['net_a_payer']).replace(',',' ')"/></strong></td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr class="text-right bg-info" style="border-top: 2px solid black;">
                                        <td colspan="3"><strong> RECAPITULATIF DES TOTAUX GENERAUX</strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_nbre_actes).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_cout_total).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_pc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_npc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_exclusion).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_ticket_moderateur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_tiers_payeur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_a_payer).replace(',',' ')"/></strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </t>
                    <!--RAPPORT DETAILLE PAR PRESTATION MEDICALE-->
                    <t t-if="report_kpi in ['prestation'] and report_type in ['detail']">
                        <div class="header">
                            <h6 class="bg-primary invisible">...</h6>
                            <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - FACTURE PRESTATAIRE DE SOINS / PRESTATION MEDICALE
                                    </strong>
                                </h4>
                            </t>
                            <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - REMBOURSEMENT DE FRAIS MEDICAUX - ADHERENT / PRESTATION MEDICALE
                                    </strong>
                                </h4>
                            </t>
                            <div class="row">
                                <div class="col-xs-6">
                                    <p>
                                       <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                       <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                    </p>
                                </div>
                                <div class="col-xs-6">
                                    <t t-if="police_filter">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </t>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                        <table class="table table-condensed" style="border:1px solid black;">
                                           <caption>1. Détails Facture Prestataire:</caption>
                                            <tr>
                                                <td>
                                                    <h4>FACTURE N°      : <strong><t t-esc="num_facture"/> </strong></h4>
                                                    <p>V/Réf.           : <t t-esc="ref_facture"/></p>
                                                    <p>Date Emission    : <t t-esc="date_emission"/> </p>
                                                    <p>Date Réception   : <t t-esc="date_reception"/></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                    <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                        <table class="table table-condensed" style="border:1px solid black;">
                                           <caption>1.Détails Remboursement Frais Médicaux:</caption>
                                            <tr>
                                                <td>
                                                    <h4>RFM N°      : <strong><t t-esc="num_rfm"/> </strong></h4>
                                                    <p>Réf. Fiche   : <t t-esc="ref_fiche"/></p>
                                                    <p>Date Saisie  : <t t-esc="date_saisie"/> </p>
                                                    <p>Date depôt   : <t t-esc="date_depot"/></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                </div>
                                <div class="col-xs-6">
                                    <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                        <table class="table table-condensed bg-info" style="border:1px solid black;">
                                           <caption>2. DOIT - Prestataire:</caption>
                                            <tr>
                                                <td>
                                                    <p class="h5"><b><t t-esc="prestataire"/></b></p>
                                                    <p>Ville: <t t-esc="city"/></p>
                                                    <p>Tél.: <t t-esc="phone"/></p>
                                                    <p>Mobile: <b><t t-esc="mobile"/></b></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                    <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                        <table class="table table-condensed bg-info" style="border:1px solid black;">
                                           <caption>2. Détails Adhérent Souscripteur:</caption>
                                            <tr>
                                                <td>
                                                    <p class="h5"><b><t t-esc="adherent"/></b></p>
                                                    <p>Matricule: <t t-esc="matricule"/></p>
                                                    <p>Code ID.: <t t-esc="code_id"/></p>
                                                    <p>Groupe: <b><t t-esc="groupe"/></b></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <div class="article">
                            <table class="table table-condensed table-bordered table-striped h6" style="width: 100% border-bottom: 2px solid black">
                                <caption>IMPORTANT: Le tableau ci-dessous présente la synthèse des actes médicaux qui ont été fournis par le prestataire de soins.
                                    Ces actes ont été regroupés par rubrique médicale en fonction de la nature et/ou le type de prestation médicale concenrnée.
                                    Sauf erreurs ou omissions, les données ont été générées automatiquement sur une période précise, c-à-d une plage de dates de début
                                    et de fin comme indiquée plus haut.
                                </caption>
                                <thead class="bg-primary" >
                                    <th class="text-right"><strong>N°</strong></th>
                                    <th class="text-left"><strong>Prestation Médicale</strong></th>
                                    <th class="text-right"><strong>Coût Moyen</strong></th>
                                    <th class="text-right"><strong>Nbre. Actes</strong></th>
                                    <th class="text-right"><strong>Totaux</strong></th>
                                    <th class="text-right"><strong>Totaux PC</strong></th>
                                    <th class="text-right"><strong>Totaux NPC</strong></th>
                                    <th class="text-right"><strong>Exclusions</strong></th>
                                    <th class="text-right"><strong>Ticket mod.</strong></th>
                                    <th class="text-right"><strong>Part SAM</strong></th>
                                    <th class="text-right"><strong>Net A Payer</strong></th>
                                </thead>
                                <tbody>
                                    <t t-set="num" t-value="0"/>
                                    <t t-set="tot_cout_moyen" t-value="0"/>
                                    <t t-set="tot_nbre_actes" t-value="0"/>
                                    <t t-set="tot_cout_total" t-value="0"/>
                                    <t t-set="tot_total_pc" t-value="0"/>
                                    <t t-set="tot_total_npc" t-value="0"/>
                                    <t t-set="tot_total_exclusion" t-value="0"/>
                                    <t t-set="tot_ticket_moderateur" t-value="0"/>
                                    <t t-set="tot_net_tiers_payeur" t-value="0"/>
                                    <t t-set="tot_net_a_payer" t-value="0"/>
                                    <t t-foreach="docs" t-as="doc">
                                        <t t-set="num" t-value="num + 1"/>
                                        <t t-set="cout_moyen" t-value="0"/>
                                        <t t-if="int(doc['nbre_actes']) != 0">
                                            <t t-set="cout_moyen" t-value="int(doc['cout_total'])/int(doc['nbre_actes'])"/>
                                        </t>
                                        <t t-set="tot_cout_moyen" t-value="tot_cout_moyen + cout_moyen"/>
                                        <t t-set="tot_nbre_actes" t-value="tot_nbre_actes + int(doc['nbre_actes'])"/>
                                        <t t-set="tot_cout_total" t-value="tot_cout_total + int(doc['cout_total'])"/>
                                        <t t-set="tot_total_pc" t-value="tot_total_pc + int(doc['total_pc'])"/>
                                        <t t-set="tot_total_npc" t-value="tot_total_npc + int(doc['total_npc'])"/>
                                        <t t-set="tot_total_exclusion" t-value="tot_total_exclusion + int(doc['total_exclusion'])"/>
                                        <t t-set="tot_ticket_moderateur" t-value="tot_ticket_moderateur + int(doc['ticket_moderateur'])"/>
                                        <t t-set="tot_net_tiers_payeur" t-value="tot_net_tiers_payeur + int(doc['net_tiers_payeur'])"/>
                                        <t t-set="tot_net_a_payer" t-value="tot_net_a_payer + int(doc['net_a_payer'])"/>
                                        <tr>
                                            <td class="text-center"><strong><span t-esc="num"/></strong></td>
                                            <td class="bg-info"><span t-esc="doc['prestation_medicale']"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(cout_moyen)).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['nbre_actes']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(doc['cout_total'])).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_pc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_npc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_exclusion']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['ticket_moderateur']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['net_tiers_payeur']).replace(',',' ')"/></td>
                                            <td class="text-right bg-info"><strong><span t-esc="'{0:,.0f}'.format(doc['net_a_payer']).replace(',',' ')"/></strong></td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr class="text-right bg-info" style="border-top: 2px solid black;">
                                        <td colspan="3"><strong> RECAPITULATIF DES TOTAUX GENERAUX</strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_nbre_actes).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_cout_total).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_pc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_npc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_exclusion).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_ticket_moderateur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_tiers_payeur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_a_payer).replace(',',' ')"/></strong></td>
                                    </tr>
                                    <tr class="text-right">
                                        <t t-if="filter_type in ['pec'] and prestataire and ref_facture">
                                            <td colspan="11">
                                                <span>Arrêtée la présente facture, à la somme de :</span> <strong><t t-esc="montant_facture"/> </strong>
                                            </td>
                                        </t>
                                        <t t-if="filter_type in ['rfm'] and adherent and num_rfm">
                                            <td colspan="11">
                                                <span>Arrêté le présent remboursement, à la somme de :</span> <strong><t t-esc="montant_rfm"/> </strong>
                                            </td>
                                        </t>
                                    </tr>
                                </tfoot>
                            </table>
                            <div class="row">
                                <div class="col-xs-12">
                                    <p><b>CADRE RESERVE COMITE DE GESTION:</b></p>
                                    <table class="table table-condensed table-bordered table-striped h6" style="border:1px solid black;">
                                        <tr>
                                            <td class="col-xs-4">
                                                <p>Règlement effectué par :_____________________________</p>
                                                <p>Montant payé (en lettre):_____________________________</p>
                                                <p>Date Règlement :_________/__________/_______________</p>
                                                <p>Réf.chèque :________________________________________</p>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa &amp; Cachet - Comptabilité</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa Correspondance</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <t t-if="filter_type in ['pec']">
                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s'
                                                % ('Code128', num_facture, 320,  60)" style="width:320;height:60;"
                                                />
                                                </t>
                                                <t t-if="filter_type in ['rfm']">
                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s'
                                                % ('Code128', num_rfm, 320,  60)" style="width:320;height:60;"
                                                    />
                                                </t>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </t>
                    <!--Rapport Synthèse par Facture/Remboursement-->
                    <t t-if="report_kpi in ['facture'] and report_type in ['groupe']">
                        <t t-if="filter_type in ['pec']">
                            <div class="header">
                                <h6 class="bg-primary invisible">...</h6>
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE FACTURES PRESTATAIRES DE SOINS MEDICAUX &amp; PARAMEDICAUX
                                    </strong>
                                </h4>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <p>
                                           <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                           <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                        </p>
                                    </div>
                                    <div class="col-xs-6">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </div>
                                </div>
                            </div>
                        </t>
                        <t t-if="filter_type in ['rfm']">
                            <div class="header">
                                <h6 class="bg-primary invisible">...</h6>
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE REMBOURSEMENTS ADHERENTS
                                    </strong>
                                </h4>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <p>
                                           <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                           <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                        </p>
                                    </div>
                                    <div class="col-xs-6">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </div>
                                </div>
                            </div>
                        </t>
                        <div class="article">
                            <table class="table table-condensed table-bordered table-striped h6" style="width: 100% border-bottom: 2px solid black">
                                <caption>IMPORTANT: Le tableau ci-dessous présente la synthèse des factures
                                    qui ont été émises par le prestataire de soins. Sauf erreurs ou omissions,
                                    les données ont été générées automatiquement sur une période précise, c-à-d,
                                    une plage de dates de début et de fin comme indiquée plus haut.
                                </caption>
                                <thead class="bg-primary" >
                                    <th class="text-right"><strong>N°</strong></th>
                                    <t t-if="filter_type in ['pec']">
                                        <th><strong>Ref. Facture</strong></th>
                                        <th class="text-right"><strong>Date Emission</strong></th>
                                        <th><strong>Prestataire de Soins Médicaux &amp; Pramédicaux</strong></th>
                                    </t>
                                    <t t-if="filter_type in ['rfm']">
                                        <th ><strong>Ref. Remb.</strong></th>
                                        <th class="text-right"><strong>Date Saisie</strong></th>
                                        <th><strong>Noms &amp; Prénoms - Adhérent</strong></th>
                                    </t>
                                    <th class="text-right"><strong>Coût Moyen</strong></th>
                                    <th class="text-right"><strong>Nbre. Actes</strong></th>
                                    <th class="text-right"><strong>Totaux</strong></th>
                                    <th class="text-right"><strong>Totaux PC</strong></th>
                                    <th class="text-right"><strong>Totaux NPC</strong></th>
                                    <th class="text-right"><strong>Exclusions</strong></th>
                                    <th class="text-right"><strong>Ticket mod.</strong></th>
                                    <th class="text-right"><strong>Part SAM</strong></th>
                                    <th class="text-right"><strong>Net A Payer</strong></th>
                                </thead>
                                <tbody>
                                    <t t-set="num" t-value="0"/>
                                    <t t-set="tot_cout_moyen" t-value="0"/>
                                    <t t-set="tot_nbre_actes" t-value="0"/>
                                    <t t-set="tot_cout_total" t-value="0"/>
                                    <t t-set="tot_total_pc" t-value="0"/>
                                    <t t-set="tot_total_npc" t-value="0"/>
                                    <t t-set="tot_total_exclusion" t-value="0"/>
                                    <t t-set="tot_ticket_moderateur" t-value="0"/>
                                    <t t-set="tot_net_tiers_payeur" t-value="0"/>
                                    <t t-set="tot_net_a_payer" t-value="0"/>
                                    <t t-foreach="docs" t-as="doc">
                                        <t t-set="num" t-value="num + 1"/>
                                        <t t-set="cout_moyen" t-value="0"/>
                                        <t t-if="int(doc['nbre_actes']) != 0">
                                            <t t-set="cout_moyen" t-value="int(doc['cout_total'])/int(doc['nbre_actes'])"/>
                                        </t>
                                        <t t-set="tot_cout_moyen" t-value="tot_cout_moyen + cout_moyen"/>
                                        <t t-set="tot_nbre_actes" t-value="tot_nbre_actes + int(doc['nbre_actes'])"/>
                                        <t t-set="tot_cout_total" t-value="tot_cout_total + int(doc['cout_total'])"/>
                                        <t t-set="tot_total_pc" t-value="tot_total_pc + int(doc['total_pc'])"/>
                                        <t t-set="tot_total_npc" t-value="tot_total_npc + int(doc['total_npc'])"/>
                                        <t t-set="tot_total_exclusion" t-value="tot_total_exclusion + int(doc['total_exclusion'])"/>
                                        <t t-set="tot_ticket_moderateur" t-value="tot_ticket_moderateur + int(doc['ticket_moderateur'])"/>
                                        <t t-set="tot_net_tiers_payeur" t-value="tot_net_tiers_payeur + int(doc['net_tiers_payeur'])"/>
                                        <t t-set="tot_net_a_payer" t-value="tot_net_a_payer + int(doc['net_a_payer'])"/>
                                        <tr>
                                            <td class="text-center"><strong><span t-esc="num"/></strong></td>
                                            <t t-if="filter_type in ['pec']">
                                                <td><strong><span t-esc="doc['num_facture']"/></strong></td>
                                                <!--<t t-set="date_emission" t-value="datetime.datetime.strptime(doc['date_emission'],'%Y-%m-%d').strftime('%d/%m/%Y')"/>-->
                                                <td class="text-right"><t t-esc="doc['date_emission']"/></td>
                                                <td class="text-left bg-info"><strong><t t-esc="doc['facture_prestataire']"/></strong></td>
                                            </t>
                                            <t t-if="filter_type in ['rfm']">
                                                <td><strong><span t-esc="doc['num_rfm']"/></strong></td>
                                                <!--<t t-set="date_saisie" t-value="datetime.datetime.strptime(doc['date_saisie'],'%Y-%m-%d %H:%M:%S').strftime('%d/%m/%Y')"/>-->
                                                <td class="text-right"><t t-esc="doc['date_saisie']"/></td>
                                                <td class="text-left bg-info"><strong><t t-esc="doc['rfm_adherent']"/></strong></td>
                                            </t>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(cout_moyen)).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['nbre_actes']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(doc['cout_total'])).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_pc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_npc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_exclusion']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['ticket_moderateur']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['net_tiers_payeur']).replace(',',' ')"/></td>
                                            <td class="text-right bg-info"><strong><span t-esc="'{0:,.0f}'.format(doc['net_a_payer']).replace(',',' ')"/></strong></td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr class="text-right bg-info" style="border-top: 2px solid black;">
                                        <td colspan="5"><strong> RECAPITULATIF DES TOTAUX GENERAUX</strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_nbre_actes).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_cout_total).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_pc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_npc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_exclusion).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_ticket_moderateur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_tiers_payeur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_a_payer).replace(',',' ')"/></strong></td>
                                    </tr>
                                    <!--<tr class="text-right">
                                        <td colspan="12">
                                            <span>Arrêtée la présente facture, à la somme de :</span> <strong><t t-esc="montant_facture"/> </strong>
                                        </td>
                                    </tr>-->
                                </tfoot>
                            </table>
                            <div class="row">
                                <div class="col-xs-12">
                                    <p><b>CADRE RESERVE COMITE DE GESTION:</b></p>
                                    <table class="table table-condensed table-bordered table-striped h6" style="border:1px solid black;">
                                        <tr>
                                            <td class="col-xs-4">
                                                <p>Règlement effectué par :_____________________________</p>
                                                <p>Montant payé (en lettre):_____________________________</p>
                                                <p>Date Règlement :_________/__________/_______________</p>
                                                <p>Réf.chèque :________________________________________</p>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa &amp; Cachet - Comptabilité</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa Correspondance</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s'
                                                % ('Code128', prestataire, 320,  60)" style="width:320;height:60;"
                                                />
                                                <!--<b>Notes / Observations</b>-->
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </t>
                    <!--Rapport detaillé par Facture/Remboursement-->
                    <t t-if="report_kpi in ['facture'] and report_type in ['detail']">
                        <t t-if="filter_type in ['pec'] and prestataire">
                            <div class="header">
                                <h6 class="bg-primary invisible">...</h6>
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE FACTURES PRESTATAIRE DE SOINS
                                    </strong>
                                </h4>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <p>
                                           <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                           <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                        </p>
                                    </div>
                                    <div class="col-xs-6">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <table class="table table-condensed bg-info" style="border:1px solid black;">
                                           <caption>INFORMATIONS - PRESTATAIRE DE SOINS MEDICAUX &amp; PARAMEDICAUX :</caption>
                                            <tr>
                                                <td>
                                                    <p class="h5"><b><t t-esc="prestataire"/></b></p>
                                                    <p>Ville: <t t-esc="city"/></p>
                                                    <p>Tél.: <t t-esc="phone"/></p>
                                                    <p>Mobile: <b><t t-esc="mobile"/></b></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-xs-6">
                                        <table class="table table-condensed" style="border:1px solid black;">
                                           <caption class="text-right" >NOTES &amp; OBSERVATIONS:</caption>
                                            <tr>
                                                <td>
                                                    <p class="invisible">.</p>
                                                    <p class="invisible">.</p>
                                                    <p class="invisible">.</p>
                                                    <p class="invisible">.</p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </t>
                        <t t-if="filter_type in ['rfm'] and adherent">
                            <div class="header">
                                <h6 class="bg-primary invisible">...</h6>
                                <h4 class="bg-info text-primary">
                                    <strong>
                                        RAPPORT - SYNTHESE REMBOURSEMENTS DE FRAIS MEDICAUX ADHERENT - SOUSCRIPTEUR
                                    </strong>
                                </h4>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <p>
                                           <span>Période du: </span> <strong><t t-esc="date_debut"/> - </strong>
                                           <span>Au: </span><strong><t t-esc="date_fin"/></strong>
                                        </p>
                                    </div>
                                    <div class="col-xs-6">
                                        <p class="text-right"> Police Couverture: <strong><t t-esc="police"/></strong></p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <table class="table table-condensed bg-info" style="border:1px solid black;">
                                           <caption>INFORMATIONS - ADHERENT/SOUSCRIPTEUR :</caption>
                                            <tr>
                                                <td>
                                                    <p class="h5"><b><t t-esc="adherent"/></b></p>
                                                    <p>Matricule: <t t-esc="matricule"/> - N° Contrat: <t t-esc="num_contrat"/> </p>
                                                    <p>Code ID.: <t t-esc="code_id"/></p>
                                                    <p>groupe: <b><t t-esc="mobile"/></b></p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-xs-6">
                                        <table class="table table-condensed" style="border:1px solid black;">
                                           <caption class="text-right" >NOTES &amp; OBSERVATIONS:</caption>
                                            <tr>
                                                <td>
                                                    <p class="invisible">.</p>
                                                    <p class="invisible">.</p>
                                                    <p class="invisible">.</p>
                                                    <p class="invisible">.</p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </t>
                        <div class="article">
                            <table class="table table-condensed table-bordered table-striped h6" style="width: 100% border-bottom: 2px solid black">
                                <caption>IMPORTANT: Le tableau ci-dessous présente la synthèse des factures
                                    qui ont été émises par le prestataire de soins. Sauf erreurs ou omissions,
                                    les données ont été générées automatiquement sur une période précise, c-à-d,
                                    une plage de dates de début et de fin comme indiquée plus haut.
                                </caption>
                                <thead class="bg-primary" >
                                    <th class="text-right"><strong>N°</strong></th>
                                    <th class="text-left"><strong>N° Facture</strong></th>
                                    <th class="text-right"><strong>Date Emission</strong></th>
                                    <th class="text-right"><strong>Coût Moyen</strong></th>
                                    <th class="text-right"><strong>Nbre. Actes</strong></th>
                                    <th class="text-right"><strong>Totaux</strong></th>
                                    <th class="text-right"><strong>Totaux PC</strong></th>
                                    <th class="text-right"><strong>Totaux NPC</strong></th>
                                    <th class="text-right"><strong>Exclusions</strong></th>
                                    <th class="text-right"><strong>Ticket mod.</strong></th>
                                    <th class="text-right"><strong>Part SAM</strong></th>
                                    <th class="text-right"><strong>Net A Payer</strong></th>
                                </thead>
                                <tbody>
                                    <t t-set="num" t-value="0"/>
                                    <t t-set="tot_cout_moyen" t-value="0"/>
                                    <t t-set="tot_nbre_actes" t-value="0"/>
                                    <t t-set="tot_cout_total" t-value="0"/>
                                    <t t-set="tot_total_pc" t-value="0"/>
                                    <t t-set="tot_total_npc" t-value="0"/>
                                    <t t-set="tot_total_exclusion" t-value="0"/>
                                    <t t-set="tot_ticket_moderateur" t-value="0"/>
                                    <t t-set="tot_net_tiers_payeur" t-value="0"/>
                                    <t t-set="tot_net_a_payer" t-value="0"/>
                                    <t t-foreach="docs" t-as="doc">
                                        <t t-set="num" t-value="num + 1"/>
                                        <t t-set="cout_moyen" t-value="0"/>
                                        <t t-if="int(doc['nbre_actes']) != 0">
                                            <t t-set="cout_moyen" t-value="int(doc['cout_total'])/int(doc['nbre_actes'])"/>
                                        </t>
                                        <t t-set="tot_cout_moyen" t-value="tot_cout_moyen + cout_moyen"/>
                                        <t t-set="tot_nbre_actes" t-value="tot_nbre_actes + int(doc['nbre_actes'])"/>
                                        <t t-set="tot_cout_total" t-value="tot_cout_total + int(doc['cout_total'])"/>
                                        <t t-set="tot_total_pc" t-value="tot_total_pc + int(doc['total_pc'])"/>
                                        <t t-set="tot_total_npc" t-value="tot_total_npc + int(doc['total_npc'])"/>
                                        <t t-set="tot_total_exclusion" t-value="tot_total_exclusion + int(doc['total_exclusion'])"/>
                                        <t t-set="tot_ticket_moderateur" t-value="tot_ticket_moderateur + int(doc['ticket_moderateur'])"/>
                                        <t t-set="tot_net_tiers_payeur" t-value="tot_net_tiers_payeur + int(doc['net_tiers_payeur'])"/>
                                        <t t-set="tot_net_a_payer" t-value="tot_net_a_payer + int(doc['net_a_payer'])"/>
                                        <tr>
                                            <td class="text-center"><strong><span t-esc="num"/></strong></td>
                                            <td><strong><span t-esc="doc['num_facture']"/></strong></td>
                                            <t t-if="prestataire">
                                                <!--<t t-set="date_emission" t-value="datetime.datetime.strptime(doc['date_emission'],'%Y-%m-%d').strftime('%d/%m/%Y')"/>-->
                                                <td class="text-right"><t t-esc="doc['date_emission']"/></td>
                                            </t>
                                            <t t-if="adherent">
                                                <td class="text-right"><t t-esc="doc['date_saisie']"/></td>
                                            </t>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(cout_moyen)).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['nbre_actes']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{:,}'.format(int(doc['cout_total'])).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_pc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_npc']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['total_exclusion']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['ticket_moderateur']).replace(',',' ')"/></td>
                                            <td class="text-right"><span t-esc="'{0:,.0f}'.format(doc['net_tiers_payeur']).replace(',',' ')"/></td>
                                            <td class="text-right bg-info"><strong><span t-esc="'{0:,.0f}'.format(doc['net_a_payer']).replace(',',' ')"/></strong></td>
                                        </tr>
                                    </t>
                                </tbody>
                                <tfoot>
                                    <tr class="text-right bg-info" style="border-top: 2px solid black;">
                                        <td colspan="4"><strong> RECAPITULATIF DES TOTAUX GENERAUX</strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_nbre_actes).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_cout_total).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_pc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_npc).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_total_exclusion).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_ticket_moderateur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_tiers_payeur).replace(',',' ')"/></strong></td>
                                        <td><strong><span t-esc="'{:,}'.format(tot_net_a_payer).replace(',',' ')"/></strong></td>
                                    </tr>
                                    <!--<tr class="text-right">
                                        <td colspan="12">
                                            <span>Arrêtée la présente facture, à la somme de :</span> <strong><t t-esc="montant_facture"/> </strong>
                                        </td>
                                    </tr>-->
                                </tfoot>
                            </table>
                            <div class="row">
                                <div class="col-xs-12">
                                    <p><b>CADRE RESERVE COMITE DE GESTION:</b></p>
                                    <table class="table table-condensed table-bordered table-striped h6" style="border:1px solid black;">
                                        <tr>
                                            <td class="col-xs-4">
                                                <p>Règlement effectué par :_____________________________</p>
                                                <p>Montant payé (en lettre):_____________________________</p>
                                                <p>Date Règlement :_________/__________/_______________</p>
                                                <p>Réf.chèque :________________________________________</p>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa &amp; Cachet - Comptabilité</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <b>Visa Correspondance</b>
                                            </td>
                                            <td class="col-xs-3 text-center">
                                                <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s'
                                                % ('Code128', prestataire, 320,  60)" style="width:320;height:60;"
                                                />
                                                <!--<b>Notes / Observations</b>-->
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
                <div class="footer">
                    <div class="row text-center" style="border-top: 2px solid black;margin-top:10px;">
                        <div class="col-xs-4 text-left">
                            SIGEM - Proximaas. Tous droits reservés. Copyright © <span t-esc="datetime.datetime.now().strftime('%Y')"/>.
                        </div>
                        <div class="col-xs-4 text-center">
                            <t t-set="date" t-value="datetime.datetime.now()"/>
                            <p>Edité par: <span t-esc="user.name"/> le: <span t-esc="date.strftime('%d-%m-%Y - %H:%M:%S')"/></p>
                        </div>
                        <div class="col-xs-4 text-right">
                            <ul class="list-inline">
                                <li>Page:</li>
                                <li>
                                    <span class="page"/>
                                </li>
                                <li>/</li>
                                <li>
                                    <span class="topage"/>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </t>
        </t>
    </template>
</odoo>